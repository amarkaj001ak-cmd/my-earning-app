<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro Job App</title>
    <!-- Hind Siliguri ‡¶´‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï -->
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #6a1b9a; --white: #ffffff; --bg: #f5f6fa; --text: #333; }
        
        /* ‡¶™‡ßÅ‡¶∞‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá Hind Siliguri ‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã */
        * { font-family: 'Hind Siliguri', sans-serif; }

        body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 90px; }
        .hidden { display: none !important; }
        
        /* Auth & Banned Screen */
        #page-auth, #page-banned { height: 100vh; background: var(--primary); display: flex; align-items: center; justify-content: center; position: fixed; width: 100%; z-index: 9999; }
        .auth-card { background: white; width: 85%; padding: 30px 20px; border-radius: 25px; text-align: center; }
        .auth-card input { width: 88%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #ddd; outline: none; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 14px; width: 100%; border-radius: 12px; font-weight: bold; cursor: pointer; }
        
        /* Beautiful & Small Fingerprint Button */
        .finger-container { display: flex; justify-content: center; margin-bottom: 12px; }
        .finger-btn { 
            background: var(--primary); 
            width: 60px; 
            height: 60px; 
            border-radius: 18px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-size: 30px; 
            box-shadow: 0 6px 15px rgba(106, 27, 154, 0.3);
            animation: wa-bounce 2s infinite ease-in-out;
        }

        /* Header */
        header { background: var(--primary); color: white; padding: 30px 20px; text-align: center; border-radius: 0 0 35px 35px; box-shadow: 0 5px 15px rgba(106, 27, 154, 0.2); }
        .balance-box { background: rgba(255,255,255,0.2); padding: 8px 22px; border-radius: 50px; display: inline-block; margin-top: 10px; font-weight: bold; border: 1px solid rgba(255,255,255,0.3); }

        /* Navigation Tabs */
        .tab-container { display: flex; margin: 15px; background: white; border-radius: 15px; padding: 5px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .tab-btn { flex: 1; text-align: center; padding: 12px; cursor: pointer; border-radius: 12px; font-weight: bold; color: #777; transition: 0.3s; }
        .tab-btn.active { background: var(--primary); color: white; }

        /* Work Section */
        .section { padding: 0 15px; }
        .card { background: white; padding: 15px; border-radius: 20px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.04); border: 1px solid #eee; }
        .job-item { display: flex; align-items: center; gap: 15px; cursor: pointer; }
        .job-img { width: 55px; height: 55px; border-radius: 12px; object-fit: cover; }
        .ad-slot { background: #f9f9f9; border: 1px dashed #ddd; padding: 5px; margin-bottom: 15px; border-radius: 15px; text-align: center; min-height: 55px; display: flex; align-items: center; justify-content: center; overflow: hidden; }

        /* History Items */
        .history-list { max-height: 300px; overflow-y: auto; margin-top: 10px; }
        .history-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; font-size: 14px; }
        .status-pending { color: #f39c12; }
        .status-success { color: #27ae60; }
        .status-rejected { color: #d63031; }

        /* WhatsApp/Fingerprint Animation */
        @keyframes wa-bounce { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-8px) scale(1.05); } }
        .wa-icon { font-size: 55px; color: #25D366; animation: wa-bounce 2s infinite ease-in-out; display: inline-block; }
        .wa-card { text-align: center; padding: 40px 20px; }
        .wa-btn { background: #25D366; color: white; padding: 15px 30px; border-radius: 50px; text-decoration: none; font-weight: bold; display: inline-block; margin-top: 20px; box-shadow: 0 5px 15px rgba(37,211,102,0.3); }

        /* Payment Icons Border */
        .pay-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .pay-option { background: white; padding: 15px; border-radius: 20px; border: 2px solid #eee; text-align: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.05); transition: 0.3s; }
        #pay-Bkash.selected { border-color: #e2136e; background: #fff0f6; }
        #pay-Nagad.selected { border-color: #f7941d; background: #fff9f2; }
        .pay-option img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid #eee; margin-bottom: 8px; }

        /* Floating Nav */
        .bottom-nav { position: fixed; bottom: 20px; left: 20px; right: 20px; background: white; display: flex; justify-content: space-around; padding: 12px 0; border-radius: 25px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); z-index: 1000; }
        .nav-item { text-align: center; color: #aaa; font-size: 11px; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 2px; }

        /* Modal */
        .modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; z-index: 2000; }
        .modal-content { background:white; width: 85%; padding: 25px; border-radius: 25px; max-height: 80vh; overflow-y: auto; }
        
        .yt-help { background: #fff1f1; border: 1px solid #ffcfcf; border-radius: 12px; padding: 10px; display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer; text-decoration: none; }
        .yt-help i { color: #ff0000; font-size: 28px; }
        .yt-help span { color: #333; font-weight: 600; font-size: 14px; }
    </style>
</head>
<body>

    <!-- Banned Screen -->
    <div id="page-banned" class="hidden">
        <div class="auth-card">
            <i class="fas fa-user-slash" style="font-size: 50px; color: #d63031; margin-bottom: 15px;"></i>
            <h2 style="color: #d63031;">‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡ßç‡¶Ø‡¶æ‡¶® ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá‡¶®!</h2>
            <p>‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶∏‡ßç‡¶•‡¶ó‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶ú‡¶æ‡¶®‡¶§‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
            <button class="btn-main" onclick="handleLogout()">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- Auth Section -->
    <div id="page-auth" class="hidden">
        <div class="auth-card">
            <div class="finger-container">
                <div class="finger-btn">
                    <i class="fas fa-fingerprint"></i>
                </div>
            </div>

            <h1 id="auth-app-name" style="margin-top: 0; font-size: 24px;">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</h1>
            
            <div id="login-form">
                <input type="email" id="login-email" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
                <input type="password" id="login-pass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
                <button class="btn-main" onclick="handleLogin()">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <p onclick="toggleAuth(false)" style="cursor:pointer; color: var(--primary); margin-top: 15px;">‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            </div>
            <div id="signup-form" class="hidden">
                <input type="text" id="reg-name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
                <input type="email" id="reg-email" placeholder="‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
                <input type="password" id="reg-pass" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
                <button class="btn-main" onclick="handleSignup()">‡¶∏‡¶æ‡¶á‡¶®‡¶Ü‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                <p onclick="toggleAuth(true)" style="cursor:pointer; color: var(--primary); margin-top: 15px;">‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="page-main" class="hidden">
        <header>
            <h2 id="main-app-name" style="margin:0">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</h2>
            <div id="greeting">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</div>
            <div class="balance-box">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥ <span id="user-balance">0.00</span></div>
        </header>

        <div class="tab-container">
            <div class="tab-btn active" onclick="switchSection('work', this)">‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶®</div>
            <div class="tab-btn" onclick="switchSection('give', this)">‡¶ï‡¶æ‡¶ú ‡¶¶‡¶ø‡¶®</div>
        </div>

        <div id="sec-work" class="section">
            <div id="job-ad-list">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</div>
        </div>

        <div id="sec-give" class="section hidden" style="text-align:center">
            <div class="card wa-card">
                <i class="fab fa-whatsapp wa-icon"></i>
                <h3 id="promo-text">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</h3>
                <a href="#" id="wa-link" class="wa-btn">‡¶π‡ßã‡ßü‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú</a>
            </div>
        </div>

        <div id="sec-withdraw" class="section hidden">
            <div class="card">
                <h3>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <p style="font-size:12px">‡¶Æ‡¶ø‡¶®‡¶ø‡¶Æ‡¶æ‡¶Æ ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞: ‡ß≥ <span id="min-with">100</span></p>
                <div class="pay-grid">
                    <div class="pay-option" id="pay-Bkash" onclick="selectPay('Bkash')">
                        <img id="logo-bkash" src="https://i.ibb.co/S7m3v5V/bkash.png">
                        <div>‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</div>
                    </div>
                    <div class="pay-option" id="pay-Nagad" onclick="selectPay('Nagad')">
                        <img id="logo-nagad" src="https://i.ibb.co/0Mv6mKj/nagad.png">
                        <div>‡¶®‡¶ó‡¶¶</div>
                    </div>
                </div>
                <input type="number" id="w-amt" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£" style="width:92%; padding:12px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd">
                <input type="text" id="w-num" placeholder="‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" style="width:92%; padding:12px; border-radius:10px; border:1px solid #ddd">
                <button class="btn-main" style="margin-top:15px" onclick="submitWithdraw()">‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
            </div>
            <h4>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø</h4>
            <div id="withdraw-history" class="card history-list">‡¶ï‡ßã‡¶®‡ßã ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á</div>
        </div>

        <div id="sec-profile" class="section hidden">
            <div class="card" style="text-align:center">
                <div style="width:60px; height:60px; background:var(--primary); color:white; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; margin:0 auto 10px; font-size:25px"><i class="fas fa-user"></i></div>
                <h2 id="u-name-display">‡¶®‡¶æ‡¶Æ</h2>
                <button onclick="handleLogout()" style="background:none; border:1px solid #ddd; padding:5px 15px; border-radius:10px; cursor:pointer">‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</button>
            </div>
            <h4>‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°</h4>
            <div id="work-history" class="card history-list">‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á</div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="showTab('sec-work', this)"><i class="fas fa-home"></i>‡¶π‡ßã‡¶Æ</div>
            <div class="nav-item" onclick="showTab('sec-withdraw', this)"><i class="fas fa-wallet"></i>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</div>
            <div class="nav-item" onclick="showTab('sec-profile', this)"><i class="fas fa-user-circle"></i>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</div>
        </div>
    </div>

    <!-- Job Modal -->
    <div id="job-modal" class="modal">
        <div class="modal-content">
            <h3 id="m-title">‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</h3>
            <p id="m-desc"></p>
            <button class="btn-main" id="m-link" style="background:#007bff">‡¶≤‡¶ø‡¶Ç‡¶ï‡ßá ‡¶Ø‡¶æ‡¶®</button>
            <hr>
            <h4>‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£ ‡¶¶‡¶ø‡¶®</h4>
            <div class="yt-help" onclick="openTutorial()">
                <i class="fab fa-youtube"></i>
                <span>‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶¶‡ßá‡¶ñ‡ßá ‡¶®‡¶ø‡¶®</span>
            </div>
            <label style="font-size: 13px; color: #666; display: block; margin-bottom: 5px;">‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶®‡¶∂‡¶ü ‡¶°‡¶ø‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶®:</label>
            <input type="text" id="m-screenshot-link" placeholder="‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®" style="width:92%; padding:10px; border-radius:10px; border:1px solid #ddd; margin-bottom: 15px;">
            <textarea id="m-comment" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶¶‡¶ø‡¶®..." style="width:92%; padding:10px; border-radius:10px; border:1px solid #ddd"></textarea>
            <button class="btn-main" id="submit-btn" style="margin-top:10px" onclick="submitWork()">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
            <button class="btn-main" style="background:#888; margin-top:5px" onclick="closeModal()">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, onSnapshot, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCy0a7XyrXz61yFpUe1nXqVpQZarsfiyBQ",
            authDomain: "sofibd-e3b0f.firebaseapp.com",
            projectId: "sofibd-e3b0f",
            storageBucket: "sofibd-e3b0f.firebasestorage.app",
            messagingSenderId: "241855810630",
            appId: "1:241855810630:web:fc24e756179ac835408e47"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let uData = null; let config = {}; let selPay = "";
        let allJobs = {}; 

        // ‡ßß. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡¶ø‡ßü‡ßá‡¶≤‡¶ü‡¶æ‡¶á‡¶Æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ (‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá)
        onSnapshot(doc(db, "settings", "appConfig"), (snap) => {
            if(snap.exists()){
                config = snap.data();
                document.getElementById('auth-app-name').innerText = config.appName || "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú";
                document.getElementById('main-app-name').innerText = config.appName || "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶ú";
                document.getElementById('promo-text').innerText = config.promoText || "";
                document.getElementById('wa-link').href = "https://wa.me/" + config.waNumber;
                document.getElementById('min-with').innerText = config.minWithdraw;
                if(config.bkashIcon) document.getElementById('logo-bkash').src = config.bkashIcon;
                if(config.nagadIcon) document.getElementById('logo-nagad').src = config.nagadIcon;
            }
        });

        function updateGreeting() {
            const hr = new Date().getHours();
            let greetingText = "";
            if (hr >= 5 && hr < 12) greetingText = "‡¶∂‡ßÅ‡¶≠ ‡¶∏‡¶ï‡¶æ‡¶≤ ‚òÄÔ∏è";
            else if (hr >= 12 && hr < 17) greetingText = "‡¶∂‡ßÅ‡¶≠ ‡¶¶‡ßÅ‡¶™‡ßÅ‡¶∞ üå§Ô∏è";
            else if (hr >= 17 && hr < 20) greetingText = "‡¶∂‡ßÅ‡¶≠ ‡¶∏‡¶®‡ßç‡¶ß‡ßç‡¶Ø‡¶æ üåÜ";
            else greetingText = "‡¶∂‡ßÅ‡¶≠ ‡¶∞‡¶æ‡¶§ üåô";
            document.getElementById('greeting').innerText = greetingText;
        }
        updateGreeting();

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                onSnapshot(doc(db, "users", user.uid), (snap) => {
                    uData = snap.data(); 
                    if(uData) {
                        if(uData.isBanned) {
                            document.getElementById('page-main').classList.add('hidden');
                            document.getElementById('page-auth').classList.add('hidden');
                            document.getElementById('page-banned').classList.remove('hidden');
                        } else {
                            document.getElementById('page-banned').classList.add('hidden');
                            document.getElementById('page-auth').classList.add('hidden');
                            document.getElementById('page-main').classList.remove('hidden');
                            renderUserData();
                            syncJobs();
                        }
                    }
                });
            } else {
                document.getElementById('page-auth').classList.remove('hidden');
                document.getElementById('page-main').classList.add('hidden');
                document.getElementById('page-banned').classList.add('hidden');
            }
        });

        function renderUserData() {
            document.getElementById('user-balance').innerText = uData.balance.toFixed(2);
            document.getElementById('u-name-display').innerText = uData.name;

            let whHTML = "";
            if(uData.workHistory && uData.workHistory.length > 0) {
                uData.workHistory.slice().reverse().forEach(w => {
                    let stText = w.status === 'Pending' ? '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç' : (w.status === 'Approved' ? '‡¶∏‡¶´‡¶≤' : '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤');
                    let stClass = w.status === 'Pending' ? 'status-pending' : (w.status === 'Approved' ? 'status-success' : 'status-rejected');
                    whHTML += `<div class="history-item"><span>${w.title} (‡ß≥${w.reward})</span><b class="${stClass}">${stText}</b></div>`;
                });
            }
            document.getElementById('work-history').innerHTML = whHTML || "‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á";

            let phHTML = "";
            if(uData.withdrawHistory && uData.withdrawHistory.length > 0) {
                uData.withdrawHistory.slice().reverse().forEach(p => {
                    let stText = p.status === 'Pending' ? '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç' : (p.status === 'Paid' ? '‡¶∏‡¶´‡¶≤' : '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤');
                    let stClass = p.status === 'Pending' ? 'status-pending' : (p.status === 'Paid' ? 'status-success' : 'status-rejected');
                    phHTML += `<div class="history-item"><span>${p.method} - ‡ß≥${p.amount}</span><b class="${stClass}">${stText}</b></div>`;
                });
            }
            document.getElementById('withdraw-history').innerHTML = phHTML || "‡¶ï‡ßã‡¶®‡ßã ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶á";
        }

        function syncJobs() {
            onSnapshot(collection(db, "jobs"), (snap) => {
                let html = ""; let jobIds = [];
                const finishedJobs = uData && uData.workHistory ? 
                    uData.workHistory.filter(w => w.status === 'Approved' || w.status === 'Pending').map(w => w.title) : [];

                snap.forEach(d => {
                    const j = d.data(); const id = d.id;
                    allJobs[id] = j; 

                    if (!finishedJobs.includes(j.title)) {
                        jobIds.push(id);
                        html += `
                        <div class="card job-item" onclick="openJob('${id}')">
                            <img src="${j.image}" class="job-img">
                            <div style="flex-grow:1">
                                <b>${j.title}</b><br>
                                <small>‡ß≥ ${j.reward}</small>
                            </div>
                        </div>
                        <div class="ad-slot" id="ad-cnt-${id}">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>`;
                    }
                });
                
                document.getElementById('job-ad-list').innerHTML = html || "<center>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶ú ‡¶®‡ßá‡¶á</center>";
                
                jobIds.forEach(id => {
                    setTimeout(() => {
                        const container = document.getElementById(`ad-cnt-${id}`);
                        if (container && config.adCode) {
                            container.innerHTML = ""; const ifr = document.createElement('iframe');
                            ifr.style.border = "none"; ifr.style.width = "320px"; ifr.style.height = "50px";
                            container.appendChild(ifr); const d = ifr.contentWindow.document;
                            d.open(); d.write(config.adCode); d.close();
                        }
                    }, 500);
                });
            });
        }

        window.showTab = (id, el) => {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        };

        window.switchSection = (t, el) => {
            document.getElementById('sec-work').classList.toggle('hidden', t !== 'work');
            document.getElementById('sec-give').classList.toggle('hidden', t !== 'give');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        };

        let curJ = {};
        window.openJob = (jobId) => {
            const job = allJobs[jobId];
            if(!job) return;
            curJ = {t: job.title, r: job.reward};
            document.getElementById('m-title').innerText = job.title;
            document.getElementById('m-desc').innerText = job.desc;
            document.getElementById('m-link').onclick = () => window.open(job.link, '_blank');
            document.getElementById('job-modal').style.display = 'flex';
        };

        window.closeModal = () => {
            document.getElementById('job-modal').style.display = 'none';
            document.getElementById('m-screenshot-link').value = "";
            document.getElementById('m-comment').value = "";
        };

        window.openTutorial = () => {
            if (config && config.ytTutorial) window.open(config.ytTutorial, '_blank');
            else alert("‡¶ü‡¶ø‡¶â‡¶ü‡ßã‡¶∞‡¶ø‡ßü‡¶æ‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!");
        };

        window.submitWork = async () => {
            const comment = document.getElementById('m-comment').value;
            const ssLink = document.getElementById('m-screenshot-link').value;
            const submitBtn = document.getElementById('submit-btn');
            if(!ssLink || !comment) return alert("‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶¶‡¶ø‡¶®!");
            submitBtn.innerText = "‡¶ú‡¶Æ‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá..."; submitBtn.disabled = true;
            try {
                await updateDoc(doc(db, "users", auth.currentUser.uid), {
                    workHistory: arrayUnion({ title: curJ.t, reward: curJ.r, status: "Pending", comment: comment, screenshot: ssLink })
                });
                alert("‡¶ï‡¶æ‡¶ú ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); closeModal();
            } catch (err) { alert("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
            finally { submitBtn.innerText = "‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®"; submitBtn.disabled = false; }
        };

        window.selectPay = (m) => {
            selPay = m;
            document.querySelectorAll('.pay-option').forEach(p => p.classList.remove('selected'));
            document.getElementById('pay-'+m).classList.add('selected');
        };

        window.submitWithdraw = async () => {
            const amt = parseFloat(document.getElementById('w-amt').value);
            const num = document.getElementById('w-num').value;
            if(!selPay || isNaN(amt) || amt < config.minWithdraw || !num) return alert("‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");
            if(amt > uData.balance) return alert("‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶®‡ßü");
            await updateDoc(doc(db, "users", auth.currentUser.uid), {
                balance: uData.balance - amt,
                withdrawHistory: arrayUnion({ method: selPay, amount: amt, number: num, status: "Pending" })
            });
            alert("‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        };

        window.handleSignup = async () => {
            const n = document.getElementById('reg-name').value;
            const e = document.getElementById('reg-email').value;
            const p = document.getElementById('reg-pass').value;
            if(!n || !e || p.length < 6) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");
            try {
                const res = await createUserWithEmailAndPassword(auth, e, p);
                await setDoc(doc(db, "users", res.user.uid), { name: n, email: e, balance: 0, workHistory: [], withdrawHistory: [], isBanned: false });
            } catch(e) { alert("‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
        };

        window.handleLogin = async () => {
            const e = document.getElementById('login-email').value;
            const p = document.getElementById('login-pass').value;
            try { await signInWithEmailAndPassword(auth, e, p); } catch(e) { alert("‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!"); }
        };

        window.handleLogout = () => signOut(auth);
        window.toggleAuth = (isL) => {
            document.getElementById('login-form').classList.toggle('hidden', !isL);
            document.getElementById('signup-form').classList.toggle('hidden', isL);
        };
    </script>
</body>
</html>